# Claude Code Guidelines –¥–ª—è wasm_vCAD

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

**–í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–¥ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ `/home/asneg/3Dwork/wasm_vCAD/ARCHITECTURE.md` –ø–µ—Ä–µ–¥ –ª—é–±—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º!**

### –ü—Ä–∞–≤–∏–ª–æ –∑–æ–ª–æ—Ç–æ–π –ª–∏–Ω–∏–∏ TypeScript/Rust

```
TypeScript (Frontend)           |  Rust WASM (Backend)
- UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã                 |  - CAD –æ–ø–µ—Ä–∞—Ü–∏–∏
- –°–æ–±—ã—Ç–∏—è                       |  - –ì–µ–æ–º–µ—Ç—Ä–∏—è
- State (Zustand)              |  - Mesh –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ (Three.js)         |  - –í—ã—á–∏—Å–ª–µ–Ω–∏—è
- –í—ã–∑–æ–≤—ã WASM                  |  - Constraints
```

### ‚ùå –°–¢–†–û–ì–û –ó–ê–ü–†–ï–©–ï–ù–û –≤ TypeScript:

1. **–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è** (–∫—Ä–æ–º–µ –ø—Ä–æ—Å—Ç—ã—Ö preview)
2. **CAD –æ–ø–µ—Ä–∞—Ü–∏–∏** (Boolean, Trim, Fillet, Offset, Mirror, Pattern)
3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è mesh/–≥–µ–æ–º–µ—Ç—Ä–∏–∏**
4. **–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã –¥–ª—è 3D/2D**
5. **–ê–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞–±–æ—Ç—ã —Å–æ —Å–∫–µ—Ç—á–µ–º**
6. **Constraints solver** ‚ö†Ô∏è (–±—ã–ª–æ –Ω–∞—Ä—É—à–µ–Ω–æ, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
7. **Intersection calculations**

### ‚úÖ –†–ê–ó–†–ï–®–ï–ù–û –≤ TypeScript:

1. **–ü—Ä–æ—Å—Ç—ã–µ —Ä–∞—Å—á–µ—Ç—ã –¥–ª—è preview** –ø—Ä–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏–∏
   - `Math.sqrt` –¥–ª—è —Ä–∞–¥–∏—É—Å–∞ –∫—Ä—É–≥–∞ –≤–æ –≤—Ä–µ–º—è mouse move
   - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è viewport (screen ‚Üî world)
   - –†–∞—Å—á–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¢–û–õ–¨–ö–û –¥–ª—è UI (–¥–ª–∏–Ω–∞, –ø–ª–æ—â–∞–¥—å –≤ properties panel)

2. **UI –æ–ø–µ—Ä–∞—Ü–∏–∏**
   - React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π (–∫–ª–∏–∫–∏, –º—ã—à—å, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞)
   - State management (Zustand)
   - Three.js –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (display only)
   - –í—ã–∑–æ–≤—ã WASM —Ñ—É–Ω–∫—Ü–∏–π
   - –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è WASM

### üîç –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º:

- [ ] –ù–µ—Ç –ª–∏ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤ TypeScript?
- [ ] –í—Å–µ CAD –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `engine.*`?
- [ ] Three.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞?
- [ ] –ù–µ—Ç –ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –º–µ–∂–¥—É TS –∏ Rust?
- [ ] Hit detection —á–µ—Ä–µ–∑ WASM `sketch_find_element_at_point`?
- [ ] –†–∞—Å—á–µ—Ç arc/fillet/offset —á–µ—Ä–µ–∑ WASM?
- [ ] Intersection calculations —á–µ—Ä–µ–∑ WASM?
- [ ] **Constraint solving —á–µ—Ä–µ–∑ WASM `sketch_solve_constraints`?**

### üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:

#### ‚ö†Ô∏è –°–ø–æ—Ä–Ω—ã–µ —Å–ª—É—á–∞–∏ (—Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è):

**`sketchUtils.ts` - `updateElementPoint()`**
- ‚ùå **–ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–û–ï –ù–ê–†–£–®–ï–ù–ò–ï**: –ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–∏ drag
  - –°—Ç—Ä–æ–∫–∏ 310-314: `Math.sqrt` –¥–ª—è —Ä–∞–¥–∏—É—Å–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏
  - –°—Ç—Ä–æ–∫–∏ 323-333: `Math.atan2` –¥–ª—è —É–≥–ª–æ–≤ –¥—É–≥–∏
- ü§î **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: Real-time –¥—Ä–∞–≥ —Ç—Ä–µ–±—É–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
- ‚úÖ **–ö–æ–º–ø—Ä–æ–º–∏—Å—Å**: –ü–æ—Å–ª–µ drag –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è WASM constraint solver
- üìå **–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–Ω—è—Ç–æ –∫–∞–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –∫–æ–º–ø—Ä–æ–º–∏—Å—Å –¥–ª—è UX

**`sketchUtils.ts` - `getElementControlPoints()`**
- ‚úÖ **–î–û–ü–£–°–¢–ò–ú–û**: –†–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫ –¥–ª—è UI
  - –°—Ç—Ä–æ–∫–∏ 178-192: `Math.cos/sin` –¥–ª—è –ø–æ–∑–∏—Ü–∏–π —Ç–æ—á–µ–∫ –¥—É–≥–∏
  - –°—Ç—Ä–æ–∫–∞ 136-138: Midpoint –ª–∏–Ω–∏–∏
- üìå **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: "–†–∞—Å—á–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI"

#### ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ:

**`SketchCanvas.tsx`**
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 220: `Math.sqrt` –¥–ª—è preview —Ä–∞–¥–∏—É—Å–∞ –∫—Ä—É–≥–∞ - –†–ê–ó–†–ï–®–ï–ù–û

**`sketchOperations.ts`**
- ‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ WASM: offset, mirror, linearPattern, circularPattern

**`constraintSolver.ts`**
- ‚úÖ **–£–î–ê–õ–ï–ù** - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WASM `sketch_solve_constraints`

### üõ†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π:

–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ:

1. –ù–∞–π—Ç–∏ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ TypeScript
2. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ Rust –º–æ–¥—É–ª—å (`crates/vcad-engine/src/sketch/`)
3. –°–æ–∑–¥–∞—Ç—å WASM binding –≤ `sketch_operations.rs`
4. –î–æ–±–∞–≤–∏—Ç—å wrapper –≤ `src/wasm/engine.ts`
5. –û–±–Ω–æ–≤–∏—Ç—å TypeScript –Ω–∞ –≤—ã–∑–æ–≤ WASM
6. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π TypeScript –∫–æ–¥
7. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å WASM: `npm run build:wasm`

### üìö –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

**2024-xx-xx**: –£–¥–∞–ª–µ–Ω `constraintSolver.ts`, –¥–æ–±–∞–≤–ª–µ–Ω WASM binding `sketch_solve_constraints`
- –§–∞–π–ª –Ω–∞—Ä—É—à–∞–ª –ø—Ä–∞–≤–∏–ª–æ #6 (Constraints solver)
- Rust solver —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª: `crates/vcad-engine/src/sketch/constraints.rs`
- –î–æ–±–∞–≤–ª–µ–Ω WASM binding –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `SketchCanvas.tsx`

---

**üéØ –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ**: –ï—Å–ª–∏ —Å–æ–º–Ω–µ–≤–∞–µ—à—å—Å—è - –¥–µ–ª–∞–π –≤ WASM!
